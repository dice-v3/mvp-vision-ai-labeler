"""
Test script to upload sample images to MinIO for testing.
"""

import boto3
from io import BytesIO

# MinIO configuration
s3_client = boto3.client(
    's3',
    endpoint_url='http://localhost:9002',
    aws_access_key_id='minioadmin',
    aws_secret_access_key='minioadmin',
    region_name='us-east-1',
    use_ssl=False
)

# Create a minimal JPEG file (1x1 pixel)
def create_minimal_jpeg(color_index):
    """Create a minimal valid JPEG file."""
    # This is a minimal 1x1 red pixel JPEG
    jpeg_bytes = bytes([
        0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01,
        0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xFF, 0xDB, 0x00, 0x43,
        0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x00,
        0x0B, 0x08, 0x00, 0x01, 0x00, 0x01, 0x01, 0x01, 0x11, 0x00, 0xFF, 0xC4,
        0x00, 0x14, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xC4, 0x00, 0x14,
        0x10, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xDA, 0x00, 0x08, 0x01, 0x01,
        0x00, 0x00, 0x3F, 0x00, 0x37, 0xFF, 0xD9
    ])
    return jpeg_bytes

# Upload test images
def upload_test_images():
    """Upload sample images to MinIO."""
    bucket = 'datasets'
    dataset_id = 'ds_test_001'

    print(f"Uploading test images to bucket '{bucket}', dataset '{dataset_id}'...")

    # Create and upload 5 test images
    for i in range(1, 6):
        # Create minimal JPEG
        jpeg_data = create_minimal_jpeg(i)

        # Upload to MinIO
        key = f"{dataset_id}/images/test_image_{i:03d}.jpg"

        try:
            s3_client.put_object(
                Bucket=bucket,
                Key=key,
                Body=jpeg_data,
                ContentType='image/jpeg',
                Metadata={
                    'test': 'true',
                    'image_number': str(i)
                }
            )
            print(f"[OK] Uploaded: {key} ({len(jpeg_data)} bytes)")
        except Exception as e:
            print(f"[ERROR] Failed to upload {key}: {e}")

    print("\nDone! Test images uploaded successfully.")
    print(f"\nYou can view them at: http://localhost:9003 (MinIO Console)")
    print(f"Login: minioadmin / minioadmin")
    print(f"\nBucket: {bucket}")
    print(f"Path: {dataset_id}/images/")

if __name__ == "__main__":
    upload_test_images()
