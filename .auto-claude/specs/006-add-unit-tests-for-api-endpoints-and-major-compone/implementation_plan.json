{
  "feature": "Add unit tests for API endpoints and major components",
  "description": "Backend has only 8 test files, none of which test the 15 API endpoint modules (datasets, annotations, projects, etc.). Frontend has 13 test files, but they only cover annotation hooks/utils. Major components like Canvas.tsx (1,420 lines), ImageList.tsx (607 lines), and RightPanel.tsx (668 lines) have no tests.",
  "created_at": "2026-01-04T09:15:59.100Z",
  "updated_at": "2026-01-04T18:18:00.000Z",
  "status": "in_progress",
  "planStatus": "ready",
  "workflow_type": "development",
  "services_involved": ["backend", "frontend"],
  "spec_file": "spec.md",
  "phases": [
    {
      "phase_id": "1",
      "title": "Setup Testing Infrastructure",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "1.1",
          "title": "Setup backend API test infrastructure",
          "description": "Create conftest.py with FastAPI TestClient fixtures, database fixtures, auth mocks, and common test utilities for API endpoint testing.",
          "status": "completed",
          "files": [
            "backend/tests/conftest.py",
            "backend/tests/fixtures/__init__.py",
            "backend/tests/fixtures/auth_fixtures.py",
            "backend/tests/fixtures/db_fixtures.py"
          ],
          "dependencies": [],
          "estimated_effort": "medium",
          "notes": "Created comprehensive test infrastructure with FastAPI TestClient fixtures, database fixtures with automatic transaction rollback, authentication mocks for Keycloak, and factory fixtures for common test data. All files have valid Python syntax."
        },
        {
          "subtask_id": "1.2",
          "title": "Create frontend component test utilities",
          "description": "Setup test utilities for Canvas, ImageList, and RightPanel components including mock stores, mock API responses, and rendering helpers.",
          "status": "pending",
          "files": [
            "frontend/lib/test-utils/component-test-utils.ts",
            "frontend/lib/test-utils/mock-stores.ts",
            "frontend/lib/test-utils/mock-api.ts"
          ],
          "dependencies": [],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "2",
      "title": "Backend Core API Endpoint Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "2.1",
          "title": "Test auth.py endpoints",
          "description": "Write tests for /me endpoint including valid token, invalid token, missing token, and token claims extraction.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_auth.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "small",
          "notes": ""
        },
        {
          "subtask_id": "2.2",
          "title": "Test users.py endpoints",
          "description": "Write tests for user CRUD operations, user listing, user search, and permissions validation.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_users.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "medium",
          "notes": ""
        },
        {
          "subtask_id": "2.3",
          "title": "Test projects.py endpoints",
          "description": "Write tests for project CRUD operations, project listing, filtering, pagination, and access control.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_projects.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "large",
          "notes": ""
        },
        {
          "subtask_id": "2.4",
          "title": "Test project_permissions.py endpoints",
          "description": "Write tests for permission management, role assignment, permission validation, and access control checks.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_project_permissions.py"
          ],
          "dependencies": ["1.1", "2.3"],
          "estimated_effort": "medium",
          "notes": ""
        },
        {
          "subtask_id": "2.5",
          "title": "Test projects_classes.py endpoints",
          "description": "Write tests for class CRUD in projects, class validation, and class assignment to annotations.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_projects_classes.py"
          ],
          "dependencies": ["1.1", "2.3"],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "3",
      "title": "Backend Dataset API Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "3.1",
          "title": "Test datasets.py endpoints",
          "description": "Write tests for dataset CRUD operations, dataset listing, filtering by task type, and dataset statistics.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_datasets.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "large",
          "notes": ""
        },
        {
          "subtask_id": "3.2",
          "title": "Test platform_datasets.py endpoints",
          "description": "Write tests for platform dataset operations, public dataset access, and dataset discovery.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_platform_datasets.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "medium",
          "notes": ""
        },
        {
          "subtask_id": "3.3",
          "title": "Test admin_datasets.py endpoints",
          "description": "Write tests for admin dataset management, dataset approval, deletion, and bulk operations. Verify admin role requirement.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_admin_datasets.py"
          ],
          "dependencies": ["1.1", "3.1"],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "4",
      "title": "Backend Annotation API Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "4.1",
          "title": "Test annotations.py endpoints",
          "description": "Write tests for annotation CRUD, annotation versioning, annotation validation, and batch operations.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_annotations.py"
          ],
          "dependencies": ["1.1", "2.3"],
          "estimated_effort": "large",
          "notes": ""
        },
        {
          "subtask_id": "4.2",
          "title": "Test image_locks.py endpoints",
          "description": "Write tests for image locking/unlocking, lock expiration, lock stealing prevention, and concurrent access handling.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_image_locks.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "medium",
          "notes": ""
        },
        {
          "subtask_id": "4.3",
          "title": "Test version_diff.py endpoints",
          "description": "Write tests for version comparison, diff generation, version history, and conflict detection.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_version_diff.py"
          ],
          "dependencies": ["1.1", "4.1"],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "5",
      "title": "Backend Supporting API Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "5.1",
          "title": "Test export.py endpoints",
          "description": "Write tests for annotation export in various formats (COCO, YOLO, etc.), export validation, and file generation.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_export.py"
          ],
          "dependencies": ["1.1", "4.1"],
          "estimated_effort": "large",
          "notes": ""
        },
        {
          "subtask_id": "5.2",
          "title": "Test invitations.py endpoints",
          "description": "Write tests for invitation creation, acceptance, rejection, expiration, and email notification triggers.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_invitations.py"
          ],
          "dependencies": ["1.1", "2.2"],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "6",
      "title": "Backend Admin API Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "6.1",
          "title": "Test admin_stats.py endpoints",
          "description": "Write tests for admin statistics retrieval, metrics calculation, user activity stats, and system health. Verify admin role requirement.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_admin_stats.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "medium",
          "notes": ""
        },
        {
          "subtask_id": "6.2",
          "title": "Test admin_audit.py endpoints",
          "description": "Write tests for audit log retrieval, filtering, search, and log retention. Verify admin role requirement.",
          "status": "pending",
          "files": [
            "backend/tests/api/test_admin_audit.py"
          ],
          "dependencies": ["1.1"],
          "estimated_effort": "medium",
          "notes": ""
        }
      ]
    },
    {
      "phase_id": "7",
      "title": "Frontend Canvas Component Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "7.1",
          "title": "Test Canvas.tsx core rendering",
          "description": "Write tests for Canvas component initialization, canvas element creation, image loading, and basic rendering logic.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/Canvas.test.tsx"
          ],
          "dependencies": ["1.2"],
          "estimated_effort": "large",
          "notes": "Canvas.tsx is 1,420 lines - split tests into logical groups"
        },
        {
          "subtask_id": "7.2",
          "title": "Test Canvas.tsx annotation drawing",
          "description": "Write tests for drawing annotations (bbox, polygon, point, line), tool interactions, and drawing state management.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/Canvas-drawing.test.tsx"
          ],
          "dependencies": ["1.2", "7.1"],
          "estimated_effort": "large",
          "notes": "Test all annotation types and drawing interactions"
        },
        {
          "subtask_id": "7.3",
          "title": "Test Canvas.tsx zoom and pan",
          "description": "Write tests for zoom functionality, pan/drag, fit-to-screen, and coordinate transformations.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/Canvas-transforms.test.tsx"
          ],
          "dependencies": ["1.2", "7.1"],
          "estimated_effort": "medium",
          "notes": "Test viewport transformations and user interactions"
        },
        {
          "subtask_id": "7.4",
          "title": "Test Canvas.tsx selection and editing",
          "description": "Write tests for annotation selection, editing, resizing, moving, and deletion.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/Canvas-selection.test.tsx"
          ],
          "dependencies": ["1.2", "7.1"],
          "estimated_effort": "medium",
          "notes": "Test annotation modification workflows"
        }
      ]
    },
    {
      "phase_id": "8",
      "title": "Frontend ImageList Component Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "8.1",
          "title": "Test ImageList.tsx rendering and navigation",
          "description": "Write tests for image list rendering, thumbnail display, image selection, navigation (prev/next), and keyboard shortcuts.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/ImageList.test.tsx"
          ],
          "dependencies": ["1.2"],
          "estimated_effort": "large",
          "notes": "ImageList.tsx is 607 lines - test core list functionality"
        },
        {
          "subtask_id": "8.2",
          "title": "Test ImageList.tsx filtering and sorting",
          "description": "Write tests for filtering by annotation status, sorting options, search functionality, and pagination.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/ImageList-filters.test.tsx"
          ],
          "dependencies": ["1.2", "8.1"],
          "estimated_effort": "medium",
          "notes": "Test data manipulation features"
        },
        {
          "subtask_id": "8.3",
          "title": "Test ImageList.tsx state management",
          "description": "Write tests for image loading states, error handling, empty states, and data refetching.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/ImageList-state.test.tsx"
          ],
          "dependencies": ["1.2", "8.1"],
          "estimated_effort": "medium",
          "notes": "Test async operations and error scenarios"
        }
      ]
    },
    {
      "phase_id": "9",
      "title": "Frontend RightPanel Component Tests",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "9.1",
          "title": "Test RightPanel.tsx annotation list",
          "description": "Write tests for annotation list display, annotation selection, annotation filtering by class, and list interactions.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/RightPanel.test.tsx"
          ],
          "dependencies": ["1.2"],
          "estimated_effort": "large",
          "notes": "RightPanel.tsx is 668 lines - test panel functionality"
        },
        {
          "subtask_id": "9.2",
          "title": "Test RightPanel.tsx annotation editing",
          "description": "Write tests for annotation property editing, class assignment, attribute modification, and form validation.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/RightPanel-editing.test.tsx"
          ],
          "dependencies": ["1.2", "9.1"],
          "estimated_effort": "medium",
          "notes": "Test annotation modification through panel"
        },
        {
          "subtask_id": "9.3",
          "title": "Test RightPanel.tsx class management",
          "description": "Write tests for class creation, class editing, class deletion, and class color management in the panel.",
          "status": "pending",
          "files": [
            "frontend/components/annotation/__tests__/RightPanel-classes.test.tsx"
          ],
          "dependencies": ["1.2", "9.1"],
          "estimated_effort": "medium",
          "notes": "Test class management UI"
        }
      ]
    },
    {
      "phase_id": "10",
      "title": "Integration and Verification",
      "status": "pending",
      "subtasks": [
        {
          "subtask_id": "10.1",
          "title": "Run and verify backend tests",
          "description": "Run all backend tests with pytest, ensure all pass, check coverage reports, and fix any failing tests.",
          "status": "pending",
          "files": [],
          "dependencies": ["2.1", "2.2", "2.3", "2.4", "2.5", "3.1", "3.2", "3.3", "4.1", "4.2", "4.3", "5.1", "5.2", "6.1", "6.2"],
          "estimated_effort": "medium",
          "notes": "Target minimum 70% coverage for API endpoints"
        },
        {
          "subtask_id": "10.2",
          "title": "Run and verify frontend tests",
          "description": "Run all frontend tests with vitest, ensure all pass, check coverage reports, and fix any failing tests.",
          "status": "pending",
          "files": [],
          "dependencies": ["7.1", "7.2", "7.3", "7.4", "8.1", "8.2", "8.3", "9.1", "9.2", "9.3"],
          "estimated_effort": "medium",
          "notes": "Target minimum 70% coverage for major components"
        },
        {
          "subtask_id": "10.3",
          "title": "Update test documentation",
          "description": "Document testing patterns, update README with test running instructions, and create testing guidelines for future contributors.",
          "status": "pending",
          "files": [
            "backend/tests/README.md",
            "frontend/README.md"
          ],
          "dependencies": ["10.1", "10.2"],
          "estimated_effort": "small",
          "notes": "Include examples and best practices"
        }
      ]
    }
  ],
  "risks": [
    {
      "description": "Canvas.tsx is 1,420 lines - complex component may require extensive mocking",
      "mitigation": "Split tests into logical groups (rendering, drawing, transforms, selection) and use comprehensive test utilities"
    },
    {
      "description": "API endpoints may have complex authentication dependencies",
      "mitigation": "Create reusable auth fixtures and mock Keycloak token validation"
    },
    {
      "description": "Some API endpoints may depend on external services (S3, Redis)",
      "mitigation": "Mock external service dependencies in test fixtures"
    },
    {
      "description": "Frontend components may have complex state management with Zustand",
      "mitigation": "Create mock stores and test utilities for state management"
    }
  ],
  "success_criteria": [
    "All 15 backend API endpoint modules have comprehensive test coverage",
    "Canvas.tsx, ImageList.tsx, and RightPanel.tsx have test coverage for core functionality",
    "Backend test coverage is at least 70% for API endpoints",
    "Frontend test coverage is at least 70% for major components",
    "All tests pass in CI/CD pipeline",
    "Test documentation is complete and helpful for future contributors"
  ],
  "final_acceptance": [
    "All backend API endpoint tests are written and passing",
    "All frontend major component tests are written and passing",
    "Code coverage targets are met (70%+ for endpoints and components)",
    "Test documentation is complete",
    "Tests are integrated into CI/CD pipeline"
  ],
  "qa_signoff": {
    "status": "pending",
    "tests_passed": "",
    "issues": ""
  }
}
